https://github.com/advisories/GHSA-4jcv-vp96-94xr

tpl:
 mindsdb

Affected versions
< 23.12.4.2


vul func：
is_private_url


poc:
from flask import Flask, request, jsonify
from urllib.parse import urlparse
import socket
import ipaddress
import requests

app = Flask(__name__)

def is_private_url(url: str):
    hostname = urlparse(url).hostname
    if not hostname:
        return True
    ip = socket.gethostbyname(hostname)  # 漏洞点：仅首次解析，未防御DNS Rebinding
    if ipaddress.ip_address(ip).is_private:
        raise Exception(f"Private IP address found for {url}")

@app.route("/check_private_url", methods=["GET"])
def check_private_url():
    url = request.args.get("url")
    try:
        is_private_url(url)  # 漏洞触发点
        response = requests.get(url)  # 实际请求可能被DNS Rebinding劫持到内网IP
        return jsonify({"is_private": False, "text": response.text})
    except Exception as e:
        return jsonify({"is_private": True, "error": str(e)})

if __name__ == "__main__":
    app.run(debug=True)
