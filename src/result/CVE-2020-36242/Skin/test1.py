import unittest
import tempfile
import os
from cryptography.fernet import Fernet

from a import encrypt


class TestEncryptPathTraversal(unittest.TestCase):
    def test_path_traversal_exploit(self):
        # Setup a temporary directory structure
        with tempfile.TemporaryDirectory() as tmpdir:
            # Create a critical file in parent directory
            critical_file = os.path.join(tmpdir, 'important.txt')
            original_data = b"Sensitive data"
            with open(critical_file, 'wb') as f:
                f.write(original_data)

            # Create a subdirectory to work from
            subdir = os.path.join(tmpdir, 'workspace')
            os.makedirs(subdir)

            # Generate valid Fernet key
            key = Fernet.generate_key()

            # Execute from subdirectory with malicious path
            original_cwd = os.getcwd()
            try:
                os.chdir(subdir)
                # Attempt to encrypt parent directory's file using path traversal
                encrypt('../important.txt', key)  # Path relative to subdir
            finally:
                os.chdir(original_cwd)

if __name__ == '__main__':
    unittest.main()
